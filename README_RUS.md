<a href="https://redis.io/">
  <img src="https://github.com/JoKeRooo7/JoKeRooo7/blob/develop/icons/icons8-redis-240.png" alt="your_gif" 
     width="120" height="120">
</a>


## Работа с Redis на python


* [Установка и запуск Redis](#установка-сервера-redis-и-запуск-его)
* [Настройка конфигурации](#настройка-конфигурации)
* [Produser](#produser-производитель)
* [Consumer](#consumer-потребитель)


## Установка сервера Redis и запуск его

* macOS
    * установка `brew install redis`
    * запуск `redis-server`


## Настройка конфигурации

Я создал отдельный файл с первоначальными настройками Redis - `server_data.py`.
* **REDIS_HOST** - адрес где запущен REDIS
* **REDIS_PORT** - порт через который работает REDIS
* **QUEUE_NAME** - имя очереди в REDIS
* **SUBSCRIBE** - канал подписки, куда будут отправляться сообщения


## Produser (производитель)

Представлен файлом `produser.py`.

Формат кодировки в файле используется `utf-8`.
```python 
# -*- coding: utf-8 -*-
```

В функции `main()` создается объект хоста `redis_info`.

Также в нем присутствует бесконечный цикл для генерации сообщений в формате `json`. Для `json` используется функция `generate_json_message()`. Она генерирует слолварь с данными. Функция возращает форматированную строку в формате json из словаря message.

Сгенерированный json файл я добавляю в начало очереди с помощью метода `lpush` в канал подписки `SUBSCRIBE`.

Вывод информации в терминал происходит с помощью объекта `logger`.

Генерация происходит раз в 1 секунду `time.sleep(1)`


## Consumer (потребитель)

Файл `consumer.py`. Для запуска него нужны аргументы командной строки, номера, и если они встреться на сервере, он из поменяет местами. (Сделано для того, чтобы если плохому аккаунту(номеру счета) отправили деньги - развернуть обратно)

Функция `find_accounts(bad_accounts)` принимает в себя через запятую номера плохих аккаунтов.

В ней идет считывание всех транзакций от начала и до конца.
`reverse()` - разворачивает сообщения так, чтобы в начале были сообщения ранее отправленные.
В цикле идет считывание сообщений, и если там есть номер из `bad_accounts`, он разворачиваеи номера и выводит в терминал.

